apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 99-master-ibm
spec:
  config:
    ignition:
      version: 2.2.0
    storage:
      files:
        - path: /usr/local/bin/powersmt
          overwrite: true
          mode: 0700
          filesystem: root
          contents:
            source: data:text/plain;charset=utf-8;base64,IyEvYmluL2Jhc2gKZXhwb3J0IFBBVEg9L3Jvb3QvLmxvY2FsL2Jpbjovcm9vdC9iaW46L3NiaW46L2JpbjovdXNyL2xvY2FsL3NiaW46L3Vzci9sb2NhbC9iaW46LyB1c3Ivc2JpbjovdXNyL2JpbgpleHBvcnQgS1VCRUNPTkZJRz0vdmFyL2xpYi9rdWJlbGV0L2t1YmVjb25maWcKQ09SRVBTPSQoL2Jpbi9sc2NwdSB8IC9iaW4vYXdrIC1GOiAnICQxIH4gL15Db3JlXChzXCkgcGVyIHNvY2tldCQvIHtwcmludCAkMn0nfC9iaSBuL3hhcmdzKQpTT0NLRVRTPSQoL2Jpbi9sc2NwdSB8IC9iaW4vYXdrIC1GOiAnICQxIH4gL15Tb2NrZXRcKHNcKSQvIHtwcmludCAkMn0nfC9iaW4veGFyZ3MpIGxldCBUT1RBTENPUkVTPSRDT1JFUFMqJFNPQ0tFVFMKTUFYVEhSRUFEUz0kKC9iaW4vbHNjcHUgfCAvYmluL2F3awpsZXQgTUFYU01UPSRNQVhUSFJFQURTLyRUT1RBTENPUkVTCkNVUlJFTlRTTVQ9JCgvYmluL2xzY3B1IHwgL2Jpbi9hd2sKfC9iaW4veGFyZ3MpCndoaWxlIDogZG8KSVNOT0RFREVHUkFERUQ9JCgvYmluL29jIGdldCBub2RlICRIT1NUTkFNRSAtbyB5YW1sIHwvYmluL2dyZXAgbWFjaGluZWNvbmZpZ3VyYXQgaW9uLm9wZW5zaGlmdC5pby9yZWFzb24gfC9iaW4vZ3JlcCAidW5leHBlY3RlZCBvbi1kaXNrIHN0YXRlIHZhbGlkYXRpbmciKQpTTVRMQUJFTD0kKC9iaW4vb2MgZ2V0IG5vZGUgJEhPU1ROQU1FIC1MIFNNVCAtLW5vLWhlYWRlcnMgfC9iaW4vYXdrICd7cHJpbnQgJDZ9JyApCiAgaWYgW1sgLW4gJFNNVExBQkVMIF1dCiAgICB0aGVuCiAgICAgIGNhc2UgJFNNVExBQkVMIGluCiAgICAgICAgMSkgVEFSR0VUU01UPTEKICAgICAgOzsKICAgICAgICAyKSBUQVJHRVRTTVQ9MgogICAgICA7OwogICAgICAgIDQpIFRBUkdFVFNNVD00CiAgICAgIDs7CiAgICAgICAgOCkgVEFSR0VUU01UPTgKOzsKKikgVEFSR0VUU01UPSRDVVJSRU5UU01UIDsgZWNobyAiU01UIHZhbHVlIG11c3QgYmUgMSwgMiwgNCwgb3IgOCBhbmQgc21hbGwKZXIgdGhhbiBNYXhpbXVtIFNNVC4iCiAgICAgIDs7CmVzYWMgZWxzZQogICAgICBUQVJHRVRTTVQ9JE1BWFNNVAogIGZpCiAgaWYgW1sgLW4gJElTTk9ERURFR1JBREVEIF1dCiAgICB0aGVuCiAgICAgIHRvdWNoIC9ydW4vbWFjaGluZS1jb25maWctZGFlbW9uLWZvcmNlCiAgZmkKQ1VSUkVOVFNNVD0kKC9iaW4vbHNjcHUgfCAvYmluL2F3ayAtRjogJyAkMSB+IC9eVGhyZWFkXChzXCkgcGVyIGNvcmUkLyB7cHJpbnQgJDIgfSd8L2Jpbi94YXJncykKICBpZiBbWyAkQ1VSUkVOVFNNVCAtbmUgJFRBUkdFVFNNVCBdXQogICAgdGhlbgogICAgICBJTklUT05USFJFQUQ9MAogICAgICBJTklUT0ZGVEhSRUFEPSRUQVJHRVRTTVQKICAgICAgaWYgW1sgJE1BWFNNVCAtZ2UgJFRBUkdFVFNNVCBdXQogICAgICAgIHRoZW4KICAgICAgICAgIHdoaWxlIFtbICRJTklUT05USFJFQUQgLWx0ICRNQVhUSFJFQURTIF1dCiAgICAgICAgICBkbwogICAgICAgICAgICBPTlRIUkVBRD0kSU5JVE9OVEhSRUFECiAgICAgICAgICAgIE9GRlRIUkVBRD0kSU5JVE9GRlRIUkVBRAogICAgICAgICAgICB3aGlsZSBbWyAkT05USFJFQUQgLWx0ICRPRkZUSFJFQUQgXV0KICAgICAgICAgICAgZG8KL2Jpbi9lY2hvIDEgPiAvc3lzL2RldmljZXMvc3lzdGVtL2NwdS9jcHUkT05USFJFQUQvb25saW5lCiAgICAgICAgICAgICAgbGV0IE9OVEhSRUFEPSRPTlRIUkVBRCsxCiAgICAgICAgICAgIGRvbmUKICAgICAgICAgICAgbGV0IElOSVRPTlRIUkVBRD0kSU5JVE9OVEhSRUFEKyRNQVhTTVQKICAgICAgICAgICAgd2hpbGUgW1sgJE9GRlRIUkVBRCAtbHQgJElOSVRPTlRIUkVBRCBdXQogICAgICAgICAgICBkbwovYmluL2VjaG8gMCA+IC9zeXMvZGV2aWNlcy9zeXN0ZW0vY3B1L2NwdSRPRkZUSFJFQUQvb25saW5lCiAgICAgICAgICAgICAgbGV0IE9GRlRIUkVBRD0kT0ZGVEhSRUFEKzEKICAgICAgICAgICAgZG9uZQpsZXQgSU5JVE9GRlRIUkVBRD0kSU5JVE9GRlRIUkVBRCskTUFYU01UIGRvbmUKZWxzZQplY2hvICJUYXJnZXQgU01UIG11c3QgYmUgc21hbGxlciBvciBlcXVhbCB0aGFuIE1heGltdW0gU01UIHN1cHBvcnRlZCIKZmkgZmkKICAvYmluL3NsZWVwIDMwCmRvbmUK
        - path: /etc/systemd/system/powersmt.service
          overwrite: true
          mode: 0644
          filesystem: root
          contents:
            source: data:text/plain;charset=utf-8;base64,W1VuaXRdCkRlc2NyaXB0aW9uPVBPV0VSU01UCkFmdGVyPW5ldHdvcmstb25saW5lLnRhcmdldApbU2VydmljZV0KRXhlY1N0YXJ0PSIvdXNyL2xvY2FsL2Jpbi9wb3dlcnNtdCIKW0luc3RhbGxdCldhbnRlZEJ5PW11bHRpLXVzZXIudGFyZ2V0Cg==
    systemd:
      units:
        - name: powersmt.service
          enabled: true            
